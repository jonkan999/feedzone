---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Glömt lösenord - Feed Zone">
  <div class="container mx-auto px-4 py-12">
    <div class="max-w-md mx-auto">
      <h1 class="text-4xl font-bold text-primary !mb-5 text-center">Glömt lösenord</h1>
      
      <div class="bg-surface p-6">
        <p class="text-text-muted !mb-4">
          Ange din e-postadress så skickar vi dig en länk för att återställa ditt lösenord.
        </p>
        
        <form id="forgot-password-form" class="space-y-4">
          <div>
            <label for="email" class="block mb-2 font-semibold">Email</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              required 
              class="w-full border border-gray-300 rounded !px-2 !py-1"
              placeholder="din@email.com"
            />
          </div>
          <button 
            type="submit"
            id="forgot-password-submit-btn"
            class="w-full bg-indigo-950 hover:bg-indigo-900 text-white text-center rounded-lg font-semibold transition-all uppercase text-sm cursor-pointer !mt-6 !mb-4"
            style="padding: 0.875rem 1.5rem !important; color: white !important;"
          >
            Skicka återställningslänk
          </button>
        </form>
        
        <div class="mt-4 text-center">
          <p class="text-text-muted">
            <a href="/account/login" class="text-primary hover:text-accent">Tillbaka till inloggning</a>
          </p>
        </div>

        <div id="error-message" class="mt-4 text-red-600 hidden"></div>
        <div id="success-message" class="mt-4 text-green-600 hidden"></div>
      </div>
    </div>
  </div>
</Layout>

<script>
  if (typeof window !== 'undefined') {
    document.getElementById('forgot-password-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target as HTMLFormElement;
      const formData = new FormData(form);
      const email = formData.get('email') as string;

      const errorMessage = document.getElementById('error-message');
      const successMessage = document.getElementById('success-message');
      const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;

      // Hide previous messages
      if (errorMessage) {
        errorMessage.classList.add('hidden');
        errorMessage.textContent = '';
      }
      if (successMessage) {
        successMessage.classList.add('hidden');
        successMessage.textContent = '';
      }

      submitButton.disabled = true;
      submitButton.textContent = 'Skickar...';

      try {
        const response = await fetch('/api/auth/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });

        const data = await response.json();

        if (response.ok) {
          // Show success message
          if (successMessage) {
            successMessage.classList.remove('hidden');
            successMessage.textContent = 'Ett e-postmeddelande med återställningslänk har skickats till din e-postadress. Kontrollera din inkorg och spam-mapp.';
          }
          form.reset();
        } else {
          throw new Error(data.error || 'Kunde inte skicka återställningslänk');
        }
      } catch (error: any) {
        if (errorMessage) {
          errorMessage.classList.remove('hidden');
          errorMessage.textContent = error.message || 'Ett fel uppstod';
        }
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = 'Skicka återställningslänk';
      }
    });
  }
</script>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }
  
  #forgot-password-form button[type="submit"],
  #forgot-password-submit-btn {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
</style>

